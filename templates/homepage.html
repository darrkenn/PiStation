<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="{{ url_for('static', filename='css/output.css') }}" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>PiStation | Homepage</title>
</head>
<body class="bg-nice-bg min-h-screen min-w-screen flex flex-col justify-center content-center items-center">
<main class="flex-1 flex flex-col sm:flex-col justify-center items-center min-w-full">

    <div class="flex-1 flex flex-col sm:flex-row justify-center items-center gap-8">
        <!--Current temp box-->
        <div class="p-4 bg-nice-footer w-full min-w-80 max-w-80 md:min-w-120 md:max-w-120 min-h-54 max-h-54 h-full flex flex-col justify-start items-center rounded-2xl">
            <h1 class="text-3xl font-bold tracking-tight text-nice-red text-center relative top-0">
                Current data
            </h1>
            <h1 class="text-lg font-bold tracking-tight text-white text-center relative top-0 mb-4 opacity-80">
                Last Update: <span class="text-nice-blue">{{ time }}</span>
            </h1>
            <h2 class="text-2xl font-bold tracking-tight text-white text-center">
                Current Temp: <span class="text-nice-green">{{ temp }}</span>Â°
            </h2>
            <h2 class="text-white text-center text-2xl font-bold">
                Current Humidity: <span class="text-nice-green">{{ humidity }}</span>%
            </h2>
        </div>
        <!--Past readings box-->
        <div class="p-8 bg-nice-footer w-full min-w-80 max-w-80 md:min-w-120 md:max-w-120 min-h-54 max-h-54 h-full flex flex-col justify-start items-center rounded-2xl">
            <h1 class="text-3xl font-bold tracking-tight text-nice-red text-center mb-8">
                Past Readings
            </h1>
            <a href="{{ url_for('pastReadings') }}">
                <button class="text-nice-footer bg-white p-3 font-bold text-2xl rounded-md hover:opacity-80 hover:cursor-pointer">
                    View
                </button>
            </a>
        </div>
    </div>

    <div class="flex-1 flex flex-col sm:flex-row justify-center items-center gap">
    <div class="bg-nice-footer w-full min-w-80 max-w-80 md:min-w-120 md:max-w-120 min-h-54 max-h-54 h-full flex flex-col justify-start items-center rounded-2xl">
        <canvas id="myChart" class="lg:w-full"></canvas>
{#        <div id="buttons"></div>#}
    </div>
    </div>




    <div>
</div>



</main>
<footer class="bg-nice-footer text-white py-1 w-full flex flex-row items-center align-bottom">
    <div class="w-1/3 min-w-1/3 max-w-1/3 px-8">
        <a href="https://github.com/darrkenn/PiStation">
            <img src="/static/svg/github.svg" alt="Github" class="size-12 md:size-10">
        </a>
    </div>
    <div class="w-1/3 min-w-1/3 max-w-1/3">
        <p class="text-lg text-center font-bold">Made by darrkenn</p>
    </div>
</footer>
</body>


<script>
    const Utils = {
        CHART_COLORS: {
            red: 'rgb(255, 99, 132)',
            blue: 'rgb(54, 162, 235)',
            white: 'rgb(255, 255, 255)'
        },
        transparentize: (color, opacity) => {
            return color.replace('rgb', 'rgba').replace(')', `, ${opacity})`);
        },
        numbers: (config) => {
            const {count, min, max} = config;
            let arr = {{ pastHourTemps | tojson }};
            return arr;
        },
        days: (config) => {
            let arr = {{ pastHourTimes | tojson }}
            return arr;
            {#return monthNames.slice(0, config.count);#}
        },
        namedColor: (index) => {
            const colors = ['rgb(255, 99, 132)', 'rgb(54, 162, 235)', 'rgb(255, 206, 86)', 'rgb(75, 192, 192)'];
            return colors[index % colors.length];
        },
    };

    const DATA_COUNT = 6;
    const NUMBER_CFG = {count: DATA_COUNT, min: -100, max: 100};

    const labels = Utils.days({count: 7});
    const data = {
        labels: labels,
        datasets: [
            {
                label: 'Temperature',
                data: Utils.numbers(NUMBER_CFG),
                borderColor: '#92D922',
                backgroundColor: Utils.transparentize('#92D922'),
            },
        ]
    };

    const config = {
        type: 'line',
        data: data,
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                title: {
                    display: true,
                    text: 'Past Hour temperature',
                    color: "#FFFFFF",
                    font: {
                        size: 16,
                        weight: "bold"
                    }
                },
                scales: {
                    x: {
                        ticks: {
                            color: "#FFFFFF",
                            font: {
                                size: 11
                            }
                        },
                    }
                }
            }
        },
    };

    const myChart = new Chart(
        document.getElementById('myChart'),
        config
    );

    const actions = [
        {
            name: 'Randomize',
            handler(chart) {
                chart.data.datasets.forEach(dataset => {
                    dataset.data = Utils.numbers({count: chart.data.labels.length, min: -100, max: 100});
                });
                chart.update();
            }
        },
    ];

    const buttonContainer = document.getElementById('buttons');
    actions.forEach(action => {
        const button = document.createElement('button');
        button.innerText = action.name;
        button.onclick = () => action.handler(myChart);
        button.style.margin = '5px';
        buttonContainer.appendChild(button);
    });
</script>

