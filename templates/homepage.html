<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="{{ url_for('static', filename='css/output.css') }}" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>PiStation | Homepage</title>
</head>
<body class="bg-nice-bg min-h-screen min-w-screen flex flex-col justify-center content-center items-center">
<main class="flex-1 flex flex-col sm:flex-col justify-center items-center min-w-full">

    <div class="flex-1 p-8 sm:p-0 flex flex-col sm:flex-row justify-center items-center gap-8">
        <!--Current temp box-->
        <div class="p-4 bg-nice-footer w-full min-w-80 max-w-80 md:min-w-120 md:max-w-120 min-h-64 max-h-64 h-full flex flex-col justify-start items-center rounded-2xl gap-4">
            <div>
                <h1 class="text-4xl font-bold tracking-tight text-nice-red text-center relative top-0">
                    Current data
                </h1>
                <h1 class="text-lg font-bold tracking-tight text-white text-center relative top-0 opacity-80">
                    Last Update: <span class="text-nice-blue">{{ time }}</span>
                </h1>
            </div>
            <div>
                <h2 class="text-2xl font-bold tracking-tight text-white text-center">
                    Current Temp: <span class="text-nice-green">{{ temp }}</span>Â°
                </h2>
                <h2 class="text-white text-center text-2xl font-bold">
                    Current Humidity: <span class="text-nice-green">{{ humidity }}</span>%
                </h2>
            </div>
            <div>
                <a href="{{ url_for('pastReadings') }}">
                <button class="text-nice-footer bg-white p-2 font-bold text-2xl rounded-md hover:opacity-80 hover:cursor-pointer">
                    Past Readings
                </button>
                </a>
            </div>

        </div>
    </div>

    <div class="flex-1 flex flex-col sm:flex-row justify-center items-center gap-8 pb-4 sm:p-0">
        <div class="bg-nice-footer p-4 rounded-2xl">
            <h1 class="text-2xl text-center text-nice-red font-bold tracking-tight pb-2">
                Temperature(Past Hour)
            </h1>
            <div class="bg-white w-full min-w-80 max-w-80 md:min-w-120 md:max-w-120 md:min-h-64 md:max-h-70 h-full flex flex-col justify-start items-center">
                <canvas id="pastHourTempChart" class="lg:w-full"></canvas>
            </div>
        </div>

        <div class="bg-nice-footer p-4 rounded-2xl">
            <h1 class="text-2xl text-center text-nice-red font-bold tracking-tight pb-2">
                Humidity(Past Hour)
            </h1>
            <div class="bg-white w-full min-w-80 max-w-80 md:min-w-120 md:max-w-120 md:min-h-64 md:max-h-64 h-full flex flex-col justify-start items-center3">
                <canvas id="pastHourHumidityChart" class="lg:w-full"></canvas>
            </div>
        </div>
</div>



</main>
<footer class="bg-nice-footer text-white py-1 w-full flex flex-row items-center align-bottom">
    <div class="w-1/3 min-w-1/3 max-w-1/3 px-8">
        <a href="https://github.com/darrkenn/PiStation">
            <img src="/static/svg/github.svg" alt="Github" class="size-12 md:size-10">
        </a>
    </div>
    <div class="w-1/3 min-w-1/3 max-w-1/3">
        <p class="text-lg text-center font-bold">Made by darrkenn</p>
    </div>
</footer>
</body>


<script>
    const Utils = {
        transparentize: (color, opacity) => {
            return color.replace('rgb', 'rgba').replace(')', `, ${opacity})`);
        },
        times: (config) => {
            let arr = {{ pastHourTimes | tojson }}
            return arr;
        },
    }
    const TempUtils = {
        temperatures: (config) => {
            let arr = {{ pastHourTemps | tojson }};
            return arr;
        },
    };
    const HumidUtils = {
        humidities: (config) => {
            let arr = {{ pastHourHumidity | tojson }};
            return arr;
        },
    };

    const DATA_COUNT = 7;
    const NUMBER_CFG = {count: DATA_COUNT, min: -100, max: 100};

    const labels = Utils.times({count: DATA_COUNT});
    const tempData = {
        labels: labels,
        datasets: [
            {
                label: "Temperature",
                pointRadius: 4,
                pointHoverRadius: 6,
                data: TempUtils.temperatures(NUMBER_CFG),
                borderColor: '#92D922',
                backgroundColor: Utils.transparentize('#191919'),
            },
        ]
    };
    const humidityData = {
        labels: labels,
        datasets: [
            {
                label: 'Humidity',
                pointRadius: 4,
                pointHoverRadius: 6,
                data: HumidUtils.humidities(NUMBER_CFG),
                borderColor: '#92D922',
                backgroundColor: Utils.transparentize('#191919'),
            },
        ]
    };

    const tempConfig = {
        type: 'line',
        data: tempData,
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: false
                },
                //title: {
                    //display: true,
                    //text: 'Past Hour temperature',
                    //color: "#121212",
                    //font: {
                        //size: 16,
                        //weight: "bold",
                        //olor: "#121212"
                    //}
                //},
            },
            scales: {
                x: {
                    grid: {
                        color: '#E5E5E5',
                        borderColor: 'green'
                    },
                    ticks: {
                    color: "#000000",
                        font: {
                            size:12,
                            weight: "bold"
                        },
                    size: 11
                },
                },
                y: {
                    grid: {
                        color: '#E5E5E5',
                        borderColor: 'green'
                    },
                    ticks: {
                    color: "#000000",
                        font: {
                            size:12,
                            weight: "bold"
                        },
                    size: 11
                },
                }
            }
        },
    };

    const humidityConfig = {
        type: 'line',
        data: humidityData,
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: false
                },
                //title: {
                    //display: true,
                    //text: 'Past Hour temperature',
                    //color: "#121212",
                    //font: {
                        //size: 16,
                        //weight: "bold",
                        //olor: "#121212"
                    //}
                //},
            },
            scales: {
                x: {
                    grid: {
                        color: '#E5E5E5',
                        borderColor: 'green'
                    },
                    ticks: {
                    color: "#000000",
                        font: {
                            size:12,
                            weight: "bold"
                        },
                    size: 11
                },
                },
                y: {
                    grid: {
                        color: '#E5E5E5',
                        borderColor: 'green'
                    },
                    ticks: {
                    color: "#000000",
                        font: {
                            size:12,
                            weight: "bold"
                        },
                    size: 11
                },
                }
            }
        },
    };

    const tempChart = new Chart(
        document.getElementById('pastHourTempChart'),
        tempConfig
    );
    const humidityChart = new Chart(
        document.getElementById('pastHourHumidityChart'),
        humidityConfig
    );

</script>
